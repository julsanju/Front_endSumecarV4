<div style="height: 100vh !important; " class="relative overflow-x-auto shadow-md sm:rounded-lg space-table">

  <div class="sm:flex sm:items-center sm:justify-between">
    <h2 class="text-lg font-medium text-gray-800 dark:text-white">Peticiones Realizadas</h2>

    <!-- Boton nueva peticion -->
    <button (click)="mostrarModal()"
      class="flex items-center justify-center w-1/2 px-5 py-2 text-sm tracking-wide text-white transition-colors duration-200 bg-blue-500 rounded-lg sm:w-auto gap-x-2 hover:bg-blue-600 dark:hover:bg-blue-500 dark:bg-blue-600">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M5 12H19" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        <path d="M12 19L12 5" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
      <span>Nueva Peticion</span>
    </button>

  </div>
  <!-- Modal nueva peticion -->
  <div id="static-modal" [class.modal-open]="showModal" [hidden]="!showModal" data-modal-backdrop="static" tabindex="-1" aria-hidden="true"
    class="fixed inset-0 z-50 flex justify-center items-center bg-black bg-opacity-60 ">
    <div class="relative p-4 w-full max-w-2xl max-h-full mx-auto">
      
      <!-- Modal content -->
      <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">

        <!-- Modal body -->
        <div class="p-4 md:p-5 space-y-4">
          <form [formGroup]="formulario">
            <div class="flex flex-col items-center justify-center px-6 py-8 mx-auto lg:py-0">
              <button type="button" (click)="cerrar_modal()"
                class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
                data-modal-hide="static-modal">
                <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                  viewBox="0 0 14 14">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                </svg>
                <span class="sr-only">Close modal</span>
              </button>
              <div class="w-full bg-white rounded-lg shadow border md:mt-0 sm:max-w-md xl:p-0">

                <div class="p-6 space-y-4 md:space-y-6 sm:p-8">
                  <p class="text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl">
                    Crear nueva peticion :D
                  </p>

                  <div>
                    <label for="countries"
                      class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Selecciona
                      un asesor:</label>
                    <select id="countries" class="bg-gray-50 border border-gray-300
                        text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500
                        block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400
                        dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                      (change)="onUserSelect($event)">
                      <option selected>Selecciona un usuario:</option>
                      @for (user of users; track user) {
                      <option [value]="user.value">{{user.viewValue}}</option>
                      }
                    </select>

                  </div>

                  <div>
                    <label for="countries" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Correo
                      Asignado:</label>
                    <input formControlName="correo" type="text" id="disabled-input-2" aria-label="disabled input 2"
                      class="bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 cursor-not-allowed dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-blue-500 dark:focus:border-blue-500"
                      placeholder="example@gmail.com" [readonly]="true" />
                  </div>

                  <div>
                    <div class="input">
                      <label class="input__label" for="mensaje">Mensaje</label>
                      <textarea formControlName="mensaje" class="input__field input__field--textarea" id="mensaje"
                        formControlName="mensaje"></textarea>
                      <p class="input__description">Por favor, describa el producto adicional que desea cotizar o
                        cualquier pregunta o problema que haya experimentado.</p>
                    </div>
                  </div>
                </form>
                <form [formGroup]="formulario_detallesPeticion"></form>
                  <div>
                    <table style="border: 2px solid #ccc;">
                      <thead>
                        <tr>
                          <th style="border: 2px solid #ccc;">Artículo</th>
                          <th style="border: 2px solid #ccc;">Cantidad</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let item of detalle; let i = index">

                          <th scope="row" class="px-6 py-4 font-medium text-gray-900 ">
                            <input
                              class="block  mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300"
                              type="text" [(ngModel)]="detalle[i].articulo" id="articulo_{{i}}"
                              (keyup)="validateArticulo(i)" formControllName="articulo" />
                          </th>

                          <td style="border: 2px solid #ccc;"
                            class="px-6 py-4 bg-gray-100 whitespace-nowrap dark:text-white">
                            <input [readonly]="!articulosEscritos[i]"
                              class="block  mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 bg-gray-300 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300"
                              type="text" [(ngModel)]="detalle[i].cantidad" (keyup.enter)="addRow(i)"
                              [ngClass]="{'cursor-not-allowed': !articulosEscritos[i]}"
                              (keypress)="onKeyPress($event)" formControllName="cantidad" />
                          </td>
                        </tr>
                      </tbody>
                    </table>


                  </div>

                </div>
              </div>
            </div>
          </form>
          <button
            class="w-full bg-blue-500 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center  focus:ring-blue-800 text-white"
            type="submit" (click)="onSubmit()">
            Enviar
          </button>
          <!-- <form [formGroup]="formulario" style="height: 100vh !important; ">
            <div class="container_addInformation">
              <div class="modal">
                <div class="modal__header">
                  <span class="modal__title">Informacion adicional</span>

                </div>
                <!-- <div class="modal__body">
                  <label for="countries" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Selecciona
                    una opción:</label>
                  <select id="countries" class="bg-gray-50 border border-gray-300
                    text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500
                    block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400
                    dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                    (change)="onUserSelect($event)">
                    <option selected>Selecciona un usuario:</option>
                    @for (user of users; track user) {
                    <option [value]="user.value">{{user.viewValue}}</option>
                    }
                  </select>
                  <!-- ... Tu código existente ... -->
          <!-- <label for="countries" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Correo
                    Asignado:</label>
                  <input formControlName="correo" type="text" id="disabled-input-2" aria-label="disabled input 2"
                    class="bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 cursor-not-allowed dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-blue-500 dark:focus:border-blue-500"
                    placeholder="example@gmail.com" [readonly]="true" />
                  <div class="input">
                    <!-- [ngClass]="{'input--invalid': formularioEnviado && formulario.get('email')?.invalid}">-->
          <!-- <label class="input__label" for="mensaje">Mensaje</label>
                    <textarea formControlName="mensaje" class="input__field input__field--textarea" id="mensaje"
                      formControlName="mensaje"></textarea>
                    <p class="input__description">Por favor, describa el producto adicional que desea cotizar o
                      cualquier pregunta o problema que haya experimentado.</p>
                  </div>
                </div> -->
          <!-- <div class="modal__footer">
                  <button class="button button--primary" type="submit" (click)="onSubmit()">Enviar</button>
                </div>
              </div>
            </div>
          </form> -->

        </div>
      </div>
    </div>
  </div>

  @if(isLoading){
  <section class="bg-white dark:bg-gray-900">

    <div class="container px-6 py-10 mx-auto animate-pulse">
      <h1 class="w-48 h-2 mx-auto bg-gray-200 rounded-lg dark:bg-gray-700"></h1>

      <p class="w-64 h-2 mx-auto mt-4 bg-gray-200 rounded-lg dark:bg-gray-700"></p>
      <p class="w-64 h-2 mx-auto mt-4 bg-gray-200 rounded-lg sm:w-80 dark:bg-gray-700"></p>

      <div class="grid grid-cols-1 gap-8 mt-8 xl:mt-12 xl:gap-12 sm:grid-cols-2 lg:grid-cols-3">
        <div class="w-full ">
          <div class="w-full h-64 bg-gray-300 rounded-lg md:h-72 dark:bg-gray-600"></div>

          <h1 class="w-56 h-2 mt-4 bg-gray-200 rounded-lg dark:bg-gray-700"></h1>
          <p class="w-24 h-2 mt-4 bg-gray-200 rounded-lg dark:bg-gray-700"></p>
        </div>

        <div class="w-full ">
          <div class="w-full h-64 bg-gray-300 rounded-lg md:h-72 dark:bg-gray-600"></div>

          <h1 class="w-56 h-2 mt-4 bg-gray-200 rounded-lg dark:bg-gray-700"></h1>
          <p class="w-24 h-2 mt-4 bg-gray-200 rounded-lg dark:bg-gray-700"></p>
        </div>

        <div class="w-full ">
          <div class="w-full h-64 bg-gray-300 rounded-lg md:h-72 dark:bg-gray-600"></div>

          <h1 class="w-56 h-2 mt-4 bg-gray-200 rounded-lg dark:bg-gray-700"></h1>
          <p class="w-24 h-2 mt-4 bg-gray-200 rounded-lg dark:bg-gray-700"></p>
        </div>
      </div>
    </div>
  </section>
  }
  @if(!isLoading){
  @if(errorOccurred){
  <div class="flex flex-col items-center justify-center text-center">
    <img [src]="errorImageURL" alt="Error" class="mb-5 max-w-full h-auto mx-auto" />

  </div>
  <div class="text-center">

    <h1
      class="mb-3 text-2xl font-bold leading-tight text-gray-900 sm:text-4xl lg:text-5xl dark:text-white text-center mx-auto">
      ¡Oops! Algo salió mal.
    </h1>
    <p class="mb-5 text-base font-normal text-gray-500 md:text-lg dark:text-gray-400 text-center">No hay peticiones
      pendientes asociadas a esta
      cuenta
    </p>
  </div>
  }

  @if(!errorOccurred){

  <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
    <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
      <tr>
        <th scope="col" class="px-6 py-3"> # Peticion </th>
        <th scope="col" class="px-6 py-3"> MENSAJE </th>
        <th scope="col" class="px-6 py-3"> CLIENTE </th>
        <th scope="col" class="px-6 py-3"> TELEFONO </th>
        <th scope="col" class="px-6 py-3"> ESTADO </th>
        @if(esAdmin() || esEmpleado()){
        <th scope="col" class="px-6 py-3">
          <span class="sr-only">Finalizar</span>
        </th>
        }
      </tr>
    </thead>
    <tbody>
      @for (row of getPaginatedData(); track row) {
      <ng-container>
        <tr (click)="abrirCerrarAccordeon(row.numero_peticion)"
          class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
          <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
            <svg data-accordion-icon class="w-3 h-3 transform transition-transform ml-5"
              [ngClass]="{'rotate-180': accordeon[row.numero_peticion], 'transition-transform duration-400 ease-in-out': true}"
              aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
              <path stroke="#4b5563" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5 5 1 1 5" />
            </svg>
            {{ row.numero_peticion }}
          </td>
          <td class="px-6 py-4">{{ row.mensaje }}</td>
          <td class="px-6 py-4">{{ row.cliente }}</td>
          <td class="px-6 py-4">{{ row.telefono }}</td>
          <td class="px-2 py-2">{{ row.estado }}</td>
          @if(esAdmin() || esEmpleado() ){
          <td class="px-6 py-4 text-right">
            <button type="button" class="focus:outline-none text-white bg-green-700
                  hover:bg-green-800 focus:ring-4 focus:ring-green-300 font-small
                  rounded-lg text-xs px-5 py-2.5 me-2 mb-2 dark:bg-green-600 dark:hover:bg-green-700
                dark:focus:ring-green-800" (click)="finalizarPeticion(row.id)">
                Finalizar</button>
          </td>
          }
        </tr>
        @if(accordeon[row.numero_peticion]){
        <tr>
          <td [attr.colspan]="(esAdmin() || esEmpleado()) ? 7 : 6">
            <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
              <thead class="w-full text-xs text-white uppercase bg-gray-500 dark:bg-gray-700 dark:text-gray-400">
                <tr>
                  <th scope="col" class="px-4 py-2 ">Fecha</th>
                  <th scope="col" class="px-4 py-2 ">Hora</th>
                  <th scope="col" class="px-4 py-2">Artículo</th>
                  <th scope="col" class="px-4 py-2 ">Cantidad</th>
                  <!-- Agrega más columnas según sea necesario -->
                </tr>
              </thead>
              <tbody>
                @for(detalle of row.detalle; track detalle){
                <tr
                  class="bg-gray-100 border border-gray-900 dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 transition-all duration-6000 ease-out"
                  style="width: 100%">

                  <td class="border px-4 py-2 max-w-full">{{ row.fecha | date:'dd/MM/yyyy'}}</td>
                  <td class="border px-4 py-2 max-w-full">{{ row.fecha | date:'HH:mm:ss a'}}</td>
                  <td class="border px-4 py-2 max-w-full">{{ detalle.articulo }}</td>
                  <td class="border px-4 py-2 max-w-full">{{ detalle.cantidad }}</td>

                  <!-- Agrega más columnas según sea necesario -->
                </tr>
                }
              </tbody>
            </table>
          </td>
        </tr>
        }
      </ng-container>

      }
    </tbody>
  </table>
  <div class="flex items-center justify-between mt-4">
    <div class="flex-1 flex justify-between sm:hidden">
      <a href="#" (click)="onPageChange(currentPage - 1)"
        class="relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 dark:text-gray-400 dark:border-gray-700 rounded-md dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
        Anterior
      </a>
      <a href="#" (click)="onPageChange(currentPage + 1)"
        class="relative inline-flex items-center px-4 py-2 ml-3 text-sm font-medium text-gray-700 bg-white border border-gray-300 dark:text-gray-400 dark:border-gray-700 rounded-md dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
        Siguiente
      </a>
    </div>
    <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
      <div>
        <p class="text-sm text-gray-700 dark:text-gray-400">
          Mostrando
          <span class="font-medium">{{ (currentPage - 1) * pageSize + 1 }}</span>
          a
          <span class="font-medium">{{ getEndIndex() }}</span>
          de
          <span class="font-medium">{{ data.length }}</span>
          resultados
        </p>
      </div>
      <div>
        <nav class="relative z-0 inline-flex -space-x-px" aria-label="Pagination">
          <a (click)="onPageChange(currentPage + 1)"
            class="relative inline-flex items-center px-2 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 dark:text-gray-400 dark:border-gray-700 rounded-l-md dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
            <span class="sr-only">Anterior</span>
            <!-- Heroicon name: solid/chevron-left -->
            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
              aria-hidden="true">
              <path fill-rule="evenodd"
                d="M6.707 3.293a1 1 0 0 1 1.414 0l6 6a1 1 0 0 1 0 1.414l-6 6a1 1 0 0 1-1.414-1.414L11.586 11H3a1 1 0 1 1 0-2h8.586L6.707 4.707a1 1 0 0 1 0-1.414z"
                clip-rule="evenodd" />
            </svg>
          </a>
          <!-- Add pagination links here -->
          <!-- ... -->
          <a (click)="onPageChange(currentPage - 1)"
            class="relative inline-flex items-center px-2 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 dark:text-gray-400 dark:border-gray-700 rounded-r-md dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
            <span class="sr-only">Siguiente</span>
            <!-- Heroicon name: solid/chevron-right -->
            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
              aria-hidden="true">
              <path fill-rule="evenodd"
                d="M13.293 16.707a1 1 0 0 1-1.414 0l-6-6a1 1 0 0 1 0-1.414l6-6a1 1 0 0 1 1.414 1.414L8.414 9H17a1 1 0 1 1 0 2h-8.586l4.293 4.293a1 1 0 0 1 0 1.414z"
                clip-rule="evenodd" />
            </svg>
          </a>
        </nav>
      </div>
    </div>
  </div>

  <!--modal para peticiones-->




  }
  }
</div>